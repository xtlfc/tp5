<!--pages/index/index.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
  <view class="user-info-bar">
    <view class="user-info">
      <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.nickName}}</text>
        <text class="user-status">{{isRolling ? 'æ‘‡éª°å­ä¸­...' : 'å‡†å¤‡æ‘‡éª°å­'}}</text>
      </view>
    </view>
    <view class="stats">
      <text class="stat-item">åŒ¹é…: {{matchCount}}</text>
      <text class="stat-item">ä»Šæ—¥: {{todayRolls}}</text>
    </view>
  </view>

  <!-- æ‘‡éª°å­åŒºåŸŸ -->
  <view class="dice-section">
    <view class="dice-container {{isRolling ? 'rolling' : ''}}" bindtap="startRoll">
      <view class="dice {{diceClass}}">
        <view class="dice-face face-1" wx:if="{{diceNumber === 1}}">
          <view class="dot center"></view>
        </view>
        <view class="dice-face face-2" wx:if="{{diceNumber === 2}}">
          <view class="dot top-left"></view>
          <view class="dot bottom-right"></view>
        </view>
        <view class="dice-face face-3" wx:if="{{diceNumber === 3}}">
          <view class="dot top-left"></view>
          <view class="dot center"></view>
          <view class="dot bottom-right"></view>
        </view>
        <view class="dice-face face-4" wx:if="{{diceNumber === 4}}">
          <view class="dot top-left"></view>
          <view class="dot top-right"></view>
          <view class="dot bottom-left"></view>
          <view class="dot bottom-right"></view>
        </view>
        <view class="dice-face face-5" wx:if="{{diceNumber === 5}}">
          <view class="dot top-left"></view>
          <view class="dot top-right"></view>
          <view class="dot center"></view>
          <view class="dot bottom-left"></view>
          <view class="dot bottom-right"></view>
        </view>
        <view class="dice-face face-6" wx:if="{{diceNumber === 6}}">
          <view class="dot top-left"></view>
          <view class="dot top-right"></view>
          <view class="dot middle-left"></view>
          <view class="dot middle-right"></view>
          <view class="dot bottom-left"></view>
          <view class="dot bottom-right"></view>
        </view>
      </view>
    </view>

    <view class="dice-info">
      <text class="dice-number">ç‚¹æ•°: {{diceNumber}}</text>
      <text class="dice-tip">{{isRolling ? 'æ‘‡åŠ¨æ‰‹æœºæˆ–ç‚¹å‡»éª°å­å¼€å§‹' : 'ç‚¹å‡»éª°å­å¼€å§‹æ‘‡éª°å­'}}</text>
    </view>

    <button class="roll-btn btn-primary" bindtap="startRoll" disabled="{{isRolling}}">
      {{isRolling ? 'æ‘‡éª°å­ä¸­...' : 'æ‘‡éª°å­'}}
    </button>
  </view>

  <!-- åŒ¹é…ç»“æœ -->
  <view class="match-result" wx:if="{{matchResult}}">
    <view class="result-header">
      <text class="result-title">ğŸ‰ åŒ¹é…æˆåŠŸï¼</text>
      <text class="result-subtitle">æ‰¾åˆ°äº†åŒæ—¶æ‘‡å‡º{{diceNumber}}ç‚¹çš„æœ‹å‹</text>
    </view>

    <view class="matched-user card">
      <view class="user-card">
        <image class="matched-avatar" src="{{matchResult.avatarUrl}}" mode="aspectFill"></image>
        <view class="matched-info">
          <text class="matched-name">{{matchResult.nickName}}</text>
          <text class="matched-distance">{{matchResult.distance}}km</text>
          <text class="matched-time">{{matchResult.matchTime}}</text>
        </view>
        <button class="chat-btn btn-primary" bindtap="startChat" data-user="{{matchResult}}">
          å¼€å§‹èŠå¤©
        </button>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section" wx:if="{{rollHistory.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥è®°å½•</text>
      <text class="section-count">å…±{{rollHistory.length}}æ¬¡</text>
    </view>
    
    <view class="history-list">
      <view class="history-item" wx:for="{{rollHistory}}" wx:key="index">
        <text class="history-number">{{item.number}}</text>
        <text class="history-time">{{item.time}}</text>
        <text class="history-status {{item.matched ? 'matched' : 'no-match'}}">
          {{item.matched ? 'å·²åŒ¹é…' : 'æœªåŒ¹é…'}}
        </text>
      </view>
    </view>
  </view>

  <!-- æ‘‡åŠ¨æç¤º -->
  <view class="shake-tip" wx:if="{{!isRolling}}">
    <text class="tip-text">ğŸ’¡ æ‘‡åŠ¨æ‰‹æœºä¹Ÿå¯ä»¥å¼€å§‹æ‘‡éª°å­å“¦ï¼</text>
  </view>
</view>