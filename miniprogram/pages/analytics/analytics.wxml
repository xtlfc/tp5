<!--pages/analytics/analytics.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ•°æ®ç»Ÿè®¡</text>
    <text class="page-subtitle">äº†è§£æ‚¨çš„ä½¿ç”¨æƒ…å†µ</text>
  </view>

  <!-- æ€»ä½“ç»Ÿè®¡ -->
  <view class="stats-overview">
    <view class="stat-card card">
      <view class="stat-icon">ğŸ²</view>
      <view class="stat-info">
        <text class="stat-value">{{overview.totalRolls}}</text>
        <text class="stat-label">æ€»æ‘‡éª°å­æ¬¡æ•°</text>
      </view>
    </view>
    
    <view class="stat-card card">
      <view class="stat-icon">ğŸ‘¥</view>
      <view class="stat-info">
        <text class="stat-value">{{overview.totalMatches}}</text>
        <text class="stat-label">æ€»åŒ¹é…æ¬¡æ•°</text>
      </view>
    </view>
    
    <view class="stat-card card">
      <view class="stat-icon">ğŸ’¬</view>
      <view class="stat-info">
        <text class="stat-value">{{overview.totalMessages}}</text>
        <text class="stat-label">æ€»æ¶ˆæ¯æ•°</text>
      </view>
    </view>
    
    <view class="stat-card card">
      <view class="stat-icon">ğŸ“</view>
      <view class="stat-info">
        <text class="stat-value">{{overview.totalCalls}}</text>
        <text class="stat-label">æ€»é€šè¯æ¬¡æ•°</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="today-stats card">
    <view class="section-title">ä»Šæ—¥æ•°æ®</view>
    <view class="today-grid">
      <view class="today-item">
        <text class="today-value">{{todayStats.rolls}}</text>
        <text class="today-label">æ‘‡éª°å­</text>
      </view>
      <view class="today-item">
        <text class="today-value">{{todayStats.matches}}</text>
        <text class="today-label">åŒ¹é…</text>
      </view>
      <view class="today-item">
        <text class="today-value">{{todayStats.messages}}</text>
        <text class="today-label">æ¶ˆæ¯</text>
      </view>
      <view class="today-item">
        <text class="today-value">{{todayStats.calls}}</text>
        <text class="today-label">é€šè¯</text>
      </view>
    </view>
  </view>

  <!-- åŒ¹é…åˆ†æ -->
  <view class="match-analysis card">
    <view class="section-title">åŒ¹é…åˆ†æ</view>
    
    <view class="analysis-item">
      <text class="analysis-label">åŒ¹é…æˆåŠŸç‡</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{matchRate}}%"></view>
      </view>
      <text class="analysis-value">{{matchRate}}%</text>
    </view>
    
    <view class="analysis-item">
      <text class="analysis-label">å¹³å‡åŒ¹é…è·ç¦»</text>
      <text class="analysis-value">{{avgDistance}}km</text>
    </view>
    
    <view class="analysis-item">
      <text class="analysis-label">æœ€å¸¸æ‘‡å‡ºçš„ç‚¹æ•°</text>
      <text class="analysis-value">{{mostCommonDice}}</text>
    </view>
  </view>

  <!-- æ´»è·ƒæ—¶é—´ -->
  <view class="activity-time card">
    <view class="section-title">æ´»è·ƒæ—¶é—´åˆ†æ</view>
    
    <view class="time-chart">
      <view 
        class="time-bar"
        wx:for="{{activityTime}}" 
        wx:key="hour"
        style="height: {{item.percentage}}%"
      >
        <text class="time-label">{{item.hour}}:00</text>
        <text class="time-value">{{item.count}}</text>
      </view>
    </view>
  </view>

  <!-- ä½¿ç”¨è¶‹åŠ¿ -->
  <view class="usage-trend card">
    <view class="section-title">ä½¿ç”¨è¶‹åŠ¿ï¼ˆè¿‘7å¤©ï¼‰</view>
    
    <view class="trend-chart">
      <view 
        class="trend-item"
        wx:for="{{usageTrend}}" 
        wx:key="date"
      >
        <view class="trend-bar" style="height: {{item.percentage}}%"></view>
        <text class="trend-date">{{item.date}}</text>
        <text class="trend-value">{{item.value}}</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½ä½¿ç”¨æ’è¡Œ -->
  <view class="feature-ranking card">
    <view class="section-title">åŠŸèƒ½ä½¿ç”¨æ’è¡Œ</view>
    
    <view class="ranking-list">
      <view 
        class="ranking-item"
        wx:for="{{featureRanking}}" 
        wx:key="name"
      >
        <view class="ranking-info">
          <text class="ranking-icon">{{item.icon}}</text>
          <text class="ranking-name">{{item.name}}</text>
        </view>
        <view class="ranking-stats">
          <text class="ranking-count">{{item.count}}æ¬¡</text>
          <text class="ranking-percentage">{{item.percentage}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-section">
    <button class="refresh-btn" bindtap="refreshData" loading="{{isRefreshing}}">
      {{isRefreshing ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°æ•°æ®'}}
    </button>
  </view>
</view>